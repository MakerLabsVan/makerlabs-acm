define(["../@polymer/polymer/polymer-legacy.js","./google-js-api.js","../@polymer/polymer/lib/legacy/polymer-fn.js"],function(_polymerLegacy,_googleJsApi,_polymerFn){"use strict";var _clientLoaded=!1,_statuses={},_loaders={};(0,_polymerFn.Polymer)({is:"google-client-loader",properties:{name:String,version:String,appId:String,apiRoot:String,successEventName:{type:String,value:"google-api-load"},errorEventName:{type:String,value:"google-api-load-error"}},hostAttributes:{hidden:!0},_waiting:!1,get api(){if(window.gapi&&window.gapi.client&&window.gapi.client[this.name]){return window.gapi.client[this.name]}else{}},get auth(){return gapi.auth},ready:function(){this._loader=document.createElement("google-js-api");if(!this.shadowRoot){this.attachShadow({mode:"open"})}this.shadowRoot.appendChild(this._loader);this.listen(this._loader,"js-api-load","_loadClient")},detached:function(){this.unlisten(this._loader,"js-api-load","_loadClient")},_loadClient:function(){gapi.load("client",this._doneLoadingClient.bind(this))},_handleLoadResponse:function(response){if(response&&response.error){_statuses[this.name]="error";this._fireError(response)}else{_statuses[this.name]="loaded";this._fireSuccess()}},_fireSuccess:function(){this.fire(this.successEventName,{name:this.name,version:this.version})},_fireError:function(response){if(response&&response.error){this.fire(this.errorEventName,{name:this.name,version:this.version,error:response.error})}else{this.fire(this.errorEventName,{name:this.name,version:this.version})}},_doneLoadingClient:function(){_clientLoaded=!0;if(!this._waiting){this._loadApi()}},_createSelfRemovingListener:function(eventName){var handler=function(){_loaders[this.name].removeEventListener(eventName,handler);this._loadApi()}.bind(this);return handler},_loadApi:function(){if(_clientLoaded&&this.name&&this.version){this._waiting=!1;if("loaded"==_statuses[this.name]){this._fireSuccess()}else if("loading"==_statuses[this.name]){this._waiting=!0;_loaders[this.name].addEventListener(this.successEventName,this._createSelfRemovingListener(this.successEventName));_loaders[this.name].addEventListener(this.errorEventName,this._createSelfRemovingListener(this.errorEventName))}else if("error"==_statuses[this.name]){this._fireError(null)}else{var root;if(this.apiRoot){root=this.apiRoot}else if(this.appId){root="https://"+this.appId+".appspot.com/_ah/api"}_statuses[this.name]="loading";_loaders[this.name]=this;gapi.client.load(this.name,this.version,this._handleLoadResponse.bind(this),root)}}}})});