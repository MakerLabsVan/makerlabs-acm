<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="user-search-bar">
  <template>
    <vaadin-combo-box
      id="search-bar-combo-box"
      style="width: 100%"
      item-value-path="Name"
      item-label-path="Name"
      items="[[items]]"
    >
      <template>
        <paper-icon-item>
          <img src="[[item.Photo]]" style="border-radius: 50%; width: 48px; height: 48px;" slot="item-icon">
          <paper-item-body two-line style="min-height: 0">
            <div style="text-transform: capitalize">[[item.Name]]</div>
            <div secondary>[[item.Email]]</div>
          </paper-item-body>
        </paper-icon-item>
      </template>
    </vaadin-combo-box>
  </template>

  <script>
    class UserSearchBar extends Polymer.Element {
      static get is() { return "user-search-bar"; }

      static get properties() {
        return {
          items: {
            type: Array,
            value: []
          }
        }
      }

      ready() {
        super.ready();

        var combobox = this.shadowRoot.getElementById("search-bar-combo-box");

        console.log("before addEventListener change");
        combobox.addEventListener("change", function(e) {
          if (combobox.value) {
            var form = document.querySelector("view-user-form");
            console.log("form from search");
            console.log(form);
            form.queryUsers("where C = '" + combobox.value + "'").then(function(q) {
              console.log("before query");
              q.send(function(res) {
                var values = this.getFirstRowValuesFromResponse(res);
                if (values && values.length) {
                  this.showUser(values);
                }
              }.bind(this));
            }.bind(form));
          }
        });
      }
    }

    customElements.define(UserSearchBar.is, UserSearchBar);
  </script>
</dom-module>
