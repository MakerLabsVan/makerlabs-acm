<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MakerLabs ACM: webcomponents/</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="https://unpkg.com/mermaid@8.0.0/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad: true,
    flowchart:{
      useMaxWidth: true,
      htmlLabels: true,
    },
  });
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MakerLabs ACM
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__docs_webcomponents.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">webcomponents/ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md76"></a>
Overview</h1>
<h2>/view-user-page.html</h2>
<h3>App Startup, Initial CM Login, Fetch Form/Search Data</h3>
<p> 
<div class="mermaid">
  sequenceDiagram
    participant CM User
    participant Web Frontend
    participant Google Auth
    participant Firebase
    participant Google Proxy
    participant Users Sheet
    participant Activity Sheet

    Web Frontend->>Web Frontend: (On Login, Load Latest Form Columns)
    Web Frontend->>Web Frontend: (On Edited User, Update Search List)
    Web Frontend->>Web Frontend: (On Search, Fetch Latest Data)
    CM User->>Web Frontend: Click Login Button
    Web Frontend->>Google Auth: Open Google Login Popup
    Google Auth->>Web Frontend: OAuth Refresh Token

    loop 20 minutes
      Web Frontend->>Google Auth: Send Refresh Token
      Google Auth->>Web Frontend: ID Token (valid 1 hour)
    end

    Web Frontend->>Google Proxy: Request Users Spreadsheet Columns / Fields
    Google Proxy->>Users Sheet: (Proxied Query)
    Users Sheet->>Google Proxy: Form Fields
    Google Proxy->>Web Frontend: Form Fields
    Web Frontend->>Google Proxy: Query For All Machine IDs
    Google Proxy->>Activity Sheet: (Proxied Query)
    Activity Sheet->>Google Proxy: Machine IDs
    Google Proxy->>Web Frontend: Machine IDs
    Web Frontend->>Google Proxy: Query All Users, (Searchable Fields Only)
    Google Proxy->>Users Sheet: (Proxied Query)
    Users Sheet->>Google Proxy: Users
    Google Proxy->>Web Frontend: Users

    loop 10 seconds
      Web Frontend->>Google Proxy: Request Latest Front Desk Activity (Unassigned / No MakerLabs ID)
      Google Proxy->>Activity Sheet: (Proxied Query)
      Activity Sheet->>Google Proxy: Latest Tag IDs Within 2 Minutes
      Google Proxy->>Web Frontend: Latest Tag IDs Within 2 Minutes
    end
</div>
</p>
<h1><a class="anchor" id="autotoc_md77"></a>
Design</h1>
<p>A single HTML page (<code><a class="el" href="view-user-page_8html.html" title="Configure webapp details (icon, caching), HTML dependencies, and create the top-level &lt;app-shell /&gt;.">view-user-page.html</a></code>) provides the entrypoint for the main <a href="https://makerlabs-acm.firebaseapp.com/view-user-page.html">ACM search/view/edit Maker page</a>.</p>
<h2>WebComponents</h2>
<p>The page is composed of <a href="https://www.webcomponents.org/introduction">WebComponents</a> using Javascript classes which inherit from <a href="https://github.com/Polymer/lit-element">LitElement</a>. This allows registering and creating custom HTML elements (e.g. <code>&lt;my-element&gt;</code>) without needing a web framework (although the Polymer framework build tool is used here to minify all JS into a single bundle for uploading to Firebase Hosting).</p>
<h3>Custom WebComponents</h3>
<p>The following WebComponents classes / elements are defined:</p><ul>
<li><a class="el" href="class_app_shell.html">AppShell / &lt;app-shell&gt;</a></li>
<li><a class="el" href="class_google_signin_button.html">GoogleSigninButton / &lt;google-signin-button&gt;</a></li>
<li><a class="el" href="class_user_search_bar.html">UserSearchBar / &lt;user-search-bar&gt;</a></li>
<li><a class="el" href="class_view_user_form.html">ViewUserForm / &lt;view-user-form&gt;</a></li>
<li><a class="el" href="class_image_file_uploader.html">ImageFileUploader / &lt;image-file-uploader&gt;</a></li>
</ul>
<p>And highlighted on the following diagram: </p><div class="image">
<img src="view-user-page_annotated.png" alt="view-user-page_annotated.png"/>
<div class="caption">
Color-highlighted HTML elements used on /view-user-page</div></div>
<h2>Dynamic Maker Form / Fields</h2>
<p>The form displayed on <code><a class="el" href="view-user-page_8html.html" title="Configure webapp details (icon, caching), HTML dependencies, and create the top-level &lt;app-shell /&gt;.">view-user-page.html</a></code> &ndash; using the <code>&lt;view-user-form&gt;</code> WebComponent &ndash; is based on the current columns in the "Users" sheet of the ACM spreadsheet. This data is loaded dynamically when the page is loaded and a valid user is signed-in. Each section title in the first row of the sheet creates a separate Material Design "panel" in the form. Each column within that section will render as a suitable form control, based on the type of formatting/validation applied to the spreadsheet column. This latest set of form fields is fetched via a request to the <code>?href=users-fields</code> handler in Google Apps Script, which runs the <code>viewUsersFields</code> view to create a JSON blob describing the fields.</p>
<dl class="section note"><dt>Note</dt><dd>Accessing Google Apps Script endpoints requires a valid Google Auth, so no fields can be displayed if the user is not logged in. After logging in, and/or when refreshing the page, the latest set of fields should be rendered (e.g. after adding, removing, renaming or reordering columns).</dd></dl>
<h2>Maker Search Bar</h2>
<p>The search bar is populated from via a Google Visualization API query which extracts all data rows from the "Users" sheet when the page is loaded.</p>
<p>Whenever a new Maker is added or edited through the form, the corresponding user details should be changed in the search bar after saving has completed.</p>
<dl class="section note"><dt>Note</dt><dd>Updates to the "Users" sheet directly through Google Sheets, and/or from other users making changes through the form, will not be updated automatically. A page refresh (via e.g. Cmd-Shift-R) is required to fully sync the search bar.</dd></dl>
<h2>Automatic "Next MakerLabs ID"</h2>
<p>Clicking the "+" floating-action-button at the bottom-right of the screen will clear the form fields, and triggers populating the <code>MakerLabs ID</code> column with the next available <code>MakerLabs ID</code> based on a request to the <code>?href=next-makerlabs-id</code> handler in Google Apps Script.</p>
<h1><a class="anchor" id="autotoc_md78"></a>
Configuration</h1>
<h2>Google Spreadsheet, Google Drive, Google Login details</h2>
<p>Common customizations such as changing the Spreadsheet ID, or Google Drive profile photo folder ID, requires changing the properties on the <code>&lt;app-shell&gt;</code>, set at the bottom of <code><a class="el" href="view-user-page_8html.html" title="Configure webapp details (icon, caching), HTML dependencies, and create the top-level &lt;app-shell /&gt;.">view-user-page.html</a></code>.</p>
<h3>Firebase Hosting URL, Deployed Files, <a class="el" href="struct_function.html">Function</a> Mappings</h3>
<p>The Firebase Hosting rules and URL paths are configured at the top-level of this repository in the <a href="https://firebase.google.com/docs/hosting/full-config"><code>firebase.json</code> file</a>.</p>
<h3>Firebase Project Details</h3>
<p>The Firebase projects (and environments used by the <code>deploy -P &lt;env&gt;</code> command) are configure at the top-level of this repository in the <a href="https://firebase.google.com/docs/cli/#managing_project_aliases"><code>.firebaserc</code> file</a></p>
<h3>Hard-coded Spreadsheet Details</h3>
<p>It is possible to modify the hard-coded strings which the Google Spreadsheet uses and should be expected to match those in <a class="el" href="class_view_user_form.html">&lt;view-user-form&gt;</a>. These include constants such as Sheet names ("Users" / "Activity"), as well as which columns are fetched for search, and which section title (Row 1 text) is used for critical fields such as "MakerLabs ID".</p>
<h1><a class="anchor" id="autotoc_md79"></a>
Deployment</h1>
<h2>Build</h2>
<p>The <a href="https://github.com/Polymer/tools/tree/master/packages/cli">Polymer build system</a> is used to package all Javascript and assets into a single minified bundle. As well it can be used to run a local development server which uses the WebComponent JS files directly and serves them as they are edited.</p>
<p>The <a href="https://polymer-library.polymer-project.org/3.0/docs/tools/polymer-json"><code>polymer.json</code> file</a> is used by the <code>polymer</code> command to configure the build.</p>
<p>The build process can be invoked via: </p><div class="fragment"><div class="line">yarn build</div></div><!-- fragment --><h2>Deploy</h2>
<p>Running the Polymer build process packages the HTML, JS, and Service Worker configuration files into the <code>build</code> directory. The <code>build/es6-bundled</code> directory is uploaded to Firebase Hosting as the root of the site.</p>
<p>The deployment process can be invoked (it will rebuild first) via: </p><div class="fragment"><div class="line"># Deploy to the test environment (https://makerlabs-acm-test.firebaseapp.com)</div><div class="line">yarn deploy -P dev</div><div class="line"></div><div class="line"># Deploy to the production environment (https://makerlabs-acm.firebaseapp.com)</div><div class="line"># yarn deploy -P production</div></div><!-- fragment --><h1><a class="anchor" id="autotoc_md80"></a>
API Reference</h1>
<p><a class="el" href="group__webcomponents.html">webcomponents/ API Documentation</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</body>
</html>
